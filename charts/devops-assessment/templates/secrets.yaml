apiVersion: v1
kind: Secret
metadata:
  name: {{ include "devops-assessment.fullname" . }}-secrets
  labels:
    {{- include "devops-assessment.labels" . | nindent 4 }}
type: Opaque
data:
  # Base64 encoded values
  POSTGRES_USER: {{ .Values.postgresql.auth.username | b64enc | quote }}
  POSTGRES_PASSWORD: {{ .Values.postgresql.auth.password | b64enc | quote }}
  POSTGRES_DB: {{ .Values.postgresql.auth.database | b64enc | quote }}
  
  # Connection strings
  {{- $pgHost := printf "%s-postgres" (include "devops-assessment.fullname" .) }}
  {{- $pgUser := .Values.postgresql.auth.username }}
  {{- $pgPass := .Values.postgresql.auth.password }}
  {{- $pgDb := .Values.postgresql.auth.database }}
  {{- $dbUrl := printf "postgresql://%s:%s@%s:5432/%s" $pgUser $pgPass $pgHost $pgDb }}
  DATABASE_URL: {{ $dbUrl | b64enc | quote }}
  
  {{- $redisHost := printf "%s-redis" (include "devops-assessment.fullname" .) }}
  {{- $redisUrl := printf "redis://%s:6379" $redisHost }}
  REDIS_URL: {{ $redisUrl | b64enc | quote }}
